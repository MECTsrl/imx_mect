# Template = kernel-common.tmpl

%define pfx /opt/freescale/rootfs/%{_target_cpu}
%define pkg_name linux

Summary         : Linux kernel (core of the Linux operating system)
Name            : kernel
Version         : 2.6.35.3
Release         : imx_11.01.00
License         : GPL
Vendor          : Freescale Semiconductor
Packager        : Rob Herring
Group           : System Environment/Kernel
Source          : %{pkg_name}-%{version}.tar.bz2
Source1         : %{pkg_name}-%{version}-%{release}.bz2
URL             : http://www.kernel.org/
Patch1          : kernel-2.6.35.3-1310041712.patch
Patch2          : kernel-2.6.35.3-1310035700.patch
Patch3          : kernel-2.6.35.3-1310028574.patch
Patch4          : kernel-2.6.35.3-1316603523.patch
Patch5          : kernel-2.6.35.3-1316009304.patch
Patch6          : kernel-2.6.35.3-1317998791.patch
Patch7          : kernel-2.6.35.3-1318337806.patch
Patch8          : kernel-2.6.35.3-1318495408.patch
Patch9          : kernel-2.6.35.3-1319702741.patch
Patch10         : kernel-2.6.35.3-1329224069.patch
Patch11         : kernel-2.6.35.3-1332171148.patch
Patch12         : kernel-2.6.35.3-1333040073.patch
Patch13         : kernel-2.6.35.3-1337754222.patch
Patch14         : kernel-2.6.35.3-1348834818.patch
Patch15         : kernel-2.6.35.3-1352446729.patch
Patch16         : kernel-2.6.35.3-1353925535.patch
Patch17         : kernel-2.6.35.3-1355490258.patch
Patch18         : kernel-2.6.35.3-1359385592.patch
Patch19         : kernel-2.6.35.3-1364380255.patch
Patch20         : kernel-2.6.35.3-1366295778.patch
Patch21         : kernel-2.6.35.3-1367838157.patch
Patch22         : kernel-2.6.35.3-1367915669.patch
Patch23         : kernel-2.6.35.3-1368026104.patch
Patch24         : kernel-2.6.35.3-1374825662.patch
Patch25         : kernel-2.6.35.3-1382692579.patch
Patch26         : kernel-2.6.35.3-1389885832.patch
Patch27         : kernel-2.6.35.3-1391688299.patch
Patch28         : kernel-2.6.35.3-1406105822.patch
Patch29         : kernel-2.6.35.3-1410159845.patch
Patch30         : kernel-2.6.35.3-1412763299.patch
Patch31          : kernel-2.6.35.3-1417086426.patch
Patch32          : kernel-2.6.35.3-1417857461.patch
Patch33          : kernel-2.6.35.3-1428042966.patch
BuildRoot       : %{_tmppath}/%{name}
Prefix          : %{pfx}

# kernel-2.6.35.3-1310041712.patch : Fix the ethernet plug/unplug problem
# kernel-2.6.35.3-1310035700.patch : added the Mect logo in the logo lists
# kernel-2.6.35.3-1310028574.patch : enable keyboard GPIO using the module gpio-keys for the Mect project
# kernel-2.6.35.3-1316603523.patch : Add the RTS control
# kernel-2.6.35.3-1316009304.patch : Added support for TIANMA 4.3 LCD Display
# kernel-2.6.35.3-1317998791.patch : Added support for buzzer as char device /dev/buzzer and patched gpio_keyboard driver
# kernel-2.6.35.3-1318337806.patch : export the buzzer header to be visible for the user space
# kernel-2.6.35.3-1318495408.patch : Added in the power fail detect module, the code to get the PLC application pid and the code to send to it the signal 
# kernel-2.6.35.3-1319702741.patch : Disabled the standby display, modify the logo to 480x272 and solved the recovery ubifs bug
# kernel-2.6.35.3-1329224069.patch : Fix liminance range of tm043, introduce the config key MECT_CUSTOMIZATION, fix the keyboard press&release problem, fix the LAN problem, fix the CAN power on/off problem
# kernel-2.6.35.3-1332171148.patch : Add support for PENMOUNT driver. Modified power support to gracefully shutdown, added ele01 and val01 customization keyword for lan, wifi.
# kernel-2.6.35.3-1333040073.patch : Fixed a bug in lan enable management
# kernel-2.6.35.3-1337754222.patch : Add support for HITACHI 5.7 LCD Display
# kernel-2.6.35.3-1348834818.patch : Introduced Kconfig keys for TPAC1006, U295, added boot logo for all currently managed projects, modified buzzer driver to choose beside duration also duty cycle for VAL01 project. Patched the lcdif clock source to be compliant with display requirements and managed LCD_ENABLE signal as required by the different supported displays.
# kernel-2.6.35.3-1352446729.patch : freescale patch to solve trouble with some eth0 that won't start
# kernel-2.6.35.3-1353925535.patch : configure lan enable according to the new hardware requirement
# kernel-2.6.35.3-1355490258.patch : changed frequency for VAL01 buzzer and added patch to avoid kernel bug in gspca driver
# kernel-2.6.35.3-1359385592.patch : added support for Hitachi LCD 5.7" 640x480 pixel
# kernel-2.6.35.3-1364380255.patch: fixed polarity of dotclock for TIANMA4.3' monitor 
# kernel-2.6.35.3-1366295778.patch: added support for ROCKTECH 4.3" display
# kernel-2.6.35.3-1367838157.patch: retentive support for ATN01 project
# kernel-2.6.35.3-1367915669.patch: added CONFIG_MECT_ATN01 keyword and logo for ATN01 project
# kernel-2.6.35.3-1368026104.patch: added support for I2C RS5C372 chip through GPIO for VAL01 project
# kernel-2.6.35.3-1374825662.patch: added support for DS1390 RTC chip device
# kernel-2.6.35.3-1382692579.patch: fixed RS485 behaviour in order to stop rx while transmitting, working half duplex
# kernel-2.6.35.3-1389885832.patch: fixed LAN phy driver to work also when a direct connection (i.e. without a switch device) exists
# kernel-2.6.35.3-1391688299.patch: Added support for Formike LCD 7" display driven by ref_xtal
# kernel-2.6.35.3-1406105822.patch: Added support for TPAC1006 at power fail, uploaded various mect logo and changed logo for atn01
# kernel-2.6.35.3-1410159845.patch: Patched gpmi-nand driver to deal with bitflips in erased regions (corrupt empty space LEB error)
# kernel-2.6.35.3-1412763299.patch: Added check to get ref_gpmi as FLASH clock if configured so by bootlets.
%Description
%{summary}

%Prep
%define buildsubdir %{pkg_name}-%{version}
KSRC_DIR=${PKG_KERNEL_PATH_PRECONFIG:-%{_builddir}/%{buildsubdir}}

if [ -z "$PKG_KERNEL_LEAVESRC" ] || [ ! -d "$KSRC_DIR" ]
then
%setup -a 1 -n %{buildsubdir}
chmod 755 patches/patch-kernel.sh
./patches/patch-kernel.sh
fi
%patch1 -p1
%patch2 -p1
%patch3 -p1
%patch4 -p1
%patch5 -p1
%patch6 -p1
%patch7 -p1
%patch8 -p1
%patch9 -p1
%patch10 -p1
%patch11 -p1
%patch12 -p1
%patch13 -p1
%patch14 -p1
%patch15 -p1
%patch16 -p1
%patch17 -p1
%patch18 -p1
%patch19 -p1
%patch20 -p1
%patch21 -p1
%patch22 -p1
%patch23 -p1
%patch24 -p1
%patch25 -p1
%patch26 -p1
%patch27 -p1
%patch28 -p1
%patch29 -p1
%patch30 -p1
%patch31 -p1
%patch32 -p1
%patch33 -p1
