# /bin/sh
#
# /etc/rc.d/init.d/S30dhcpd - Start/Stop/restart  the DHCP Client daemon(s).
#
#Description : dhclient provides a mechanism for requesting the dynamic ip address from the dhcp server
#
#The following files is necessary for running the dhclient daemon(s)
#
#/etc/dhclient.conf  		: The DHCP  client  normally  gets  its  configuration  information  from this file.
#/var/lib/dhcp/dhclient.leases  : The DHCP client stores its lease database in this file.
#/var/run/dhclient.pid		: The DHCP client stores its process ID in this file.
#/sbin/dhclient-script		: The script specify the different names and /or locations for these files
KILLWAIT=3
DAEMON="dhclient"       

if [ ! -x /sbin/dhclient ]; then
	echo "dhclient not installed check it out"
	exit 1
fi	

if [ ! -x /sbin/ip ]; then
        echo "$0: Missing /sbin/ip"
        exit 1
fi

if [ ! -f /etc/dhclient.conf ]; then
	echo "$0:Missing /etc/dhclient.conf file"
	exit 1
fi

if [ ! -f /sbin/dhclient-script ]; then
	echo "$0:Missing /sbin/dhclient-script file"
	exit 1
fi

case "$1" in
                                                                                                                             
    start)
        # Ensure eth0 device is there
        if ! ip link | grep -q 'eth0'; then
                echo "$0: Network interface eth0 not present" >&2
                exit 2;
        fi
        echo "Starting ${DAEMON}"	
        ${DAEMON}
        if [ "$?" = "0" ]; then echo "Done"
        else                    echo "FAILED"; fi
        sleep 1
        ;;
                                                                                                                             
    stop)
        echo "Stopping ${DAEMON}"
        killall -9 ${DAEMON}
        sleep ${KILLWAIT}
        if [ "$?" = "0" ]; then echo "Done"
        else                    echo "FAILED"; fi
        ;;
                                                                                                                             
    restart)
        $0 stop
        sleep 1
        $0 start
        ;;
 *)
        echo "Usage: $0 (start|stop|restart)"
        exit 1
        ;;
                                                                                                                             
esac
                                                                                                                             
exit 0

