--- ltib/dist/lfs-5.1/boa/boa.spec	2013-01-09 04:58:38.000000000 +0100
+++ ltib.new/dist/lfs-5.1/boa/boa.spec	2015-10-23 23:45:26.678971978 +0200
@@ -11,9 +11,23 @@
 Packager        : Stuart Hughes
 Group           : System/Servers
 Source          : %{name}-%{version}.tar.gz
+Source1         : boa.conf
 Patch1          : boa-0.94.14rc21-nommu.patch
+Patch2          : boa-0.94.14rc21-defines.patch
+Patch3          : boa-0.94.14rc21-1416842658.patch
 BuildRoot       : %{_tmppath}/%{name}
 Prefix          : %{pfx}
+AutoReqProv     : no
+
+
+%Package rfs
+Summary         : Trimmed boa for root file system requirements.
+Group           : Applications/File
+AutoReqProv     : no
+%Description rfs
+boa package contents restricted to just the files that are
+needed at run time on the target.
+
 
 %Description
 %{summary}
@@ -24,6 +38,8 @@
 %Prep
 %setup
 %patch1 -p1 
+%patch2 -p1
+%patch3 -p1 
 
 %Build
 ac_cv_func_setvbuf_reversed=no \
@@ -33,26 +49,28 @@
 
 %Install
 rm -rf $RPM_BUILD_ROOT
-mkdir -p $RPM_BUILD_ROOT/%{pfx}/%{base}/etc/conf
-mkdir -p $RPM_BUILD_ROOT/%{pfx}/%{base}/var/log/boa
-mkdir -p $RPM_BUILD_ROOT/%{pfx}/%{_prefix}/sbin
-install -m 755 src/boa $RPM_BUILD_ROOT/%{pfx}/%{_prefix}/sbin/
-install -m 755 src/boa_indexer $RPM_BUILD_ROOT/%{pfx}/%{_prefix}/sbin/
-install -m 644 examples/boa.conf $RPM_BUILD_ROOT/%{pfx}/%{base}/etc/conf/
-ln -s conf/boa.conf $RPM_BUILD_ROOT/%{pfx}/%{base}/etc/boa.conf
-ln -s boa $RPM_BUILD_ROOT/%{pfx}/%{_prefix}/sbin/boa_d
-perl -ni -e '
-    m,#ServerName,  &&  do { $_ = "ServerName localhost\n" } ;
-    m,^DocumentRoot, && do { $_ = "DocumentRoot /var/www/html\n" };
-    m,^DirectoryMaker, && do { $_ = "DirectoryMaker %{_prefix}/sbin/boa_indexer\n" };
-    m,^DefaultType, && do { $_ = "DefaultType text/html\n" };
-    m,^ScriptAlias, &&  do { $_ = "ScriptAlias /cgi-bin/ /var/www/cgi-bin/\n"};
-    print;
-    ' $RPM_BUILD_ROOT/%{pfx}/%{base}/etc/conf/boa.conf
+mkdir -p $RPM_BUILD_ROOT%{pfx}/%{base}/etc/conf
+mkdir -p $RPM_BUILD_ROOT%{pfx}/%{base}/var/log/boa
+mkdir -p $RPM_BUILD_ROOT%{pfx}/%{_prefix}/sbin
+install -m 755 src/boa $RPM_BUILD_ROOT%{pfx}/%{_prefix}/sbin/
+install -m 755 src/boa_indexer $RPM_BUILD_ROOT%{pfx}/%{_prefix}/sbin/
+install -m 644 examples/boa.conf $RPM_BUILD_ROOT%{pfx}/%{base}/etc/conf/
+ln -s conf/boa.conf $RPM_BUILD_ROOT%{pfx}/%{base}/etc/boa.conf
+ln -s boa $RPM_BUILD_ROOT%{pfx}/%{_prefix}/sbin/boa_d
+install -m 644 %{SOURCE1} $RPM_BUILD_ROOT%{pfx}/%{base}/etc/conf/boa.conf
+
+cd %{_builddir}/%{name}-%{version}
+( cd $RPM_BUILD_ROOT; find .%{pfx} \( \( -not -type d \) -o \( -type d -empty \) \) -print | sed 's/^\.//' ) > all_files.lst
+sed -n '
+    p
+' all_files.lst > rfs_files.lst
 
 %Clean
 rm -rf $RPM_BUILD_ROOT
 
-%Files
+%Files -f all_files.lst
+%defattr(-,root,root)
+
+
+%Files rfs -f rfs_files.lst
 %defattr(-,root,root)
-%{pfx}/*
