--- ltib/dist/lfs-5.1/boot_stream/boot_stream.spec	2013-01-09 04:58:38.000000000 +0100
+++ ltib.new/dist/lfs-5.1/boot_stream/boot_stream.spec	2015-10-23 01:24:50.227008412 +0200
@@ -8,15 +8,52 @@
 Vendor          : Freescale
 Packager        : Terry Lv
 Group           : Tools
-Source          : %{name}-%{version}-%{release}.tar.gz
+Source          : %{name}-11.01.00.tar.gz
+Source1         : updater_ivt.sb
+Patch1          : imx-bootlets-src-11.01.00-1315841439.patch
+Patch2          : imx-bootlets-src-11.01.00-1332172356.patch
+Patch3          : imx-bootlets-src-11.01.00-1337962710.patch
+Patch4          : imx-bootlets-src-11.01.00-1412693346.patch
+Patch5          : imx-bootlets-src-11.01.00-1418123773.patch
+Patch6          : imx-bootlets-src-11.01.00-1418123774.patch
 BuildRoot       : %{_tmppath}/%{name}
 Prefix          : %{pfx}
+AutoReqProv     : no
 
+
+%Package rfs
+Summary         : Trimmed imx-bootlets-src for root file system requirements.
+Group           : Applications/File
+AutoReqProv     : no
+%Description rfs
+imx-bootlets-src package contents restricted to just the files
+that are needed at run time on the target.
+
+%Package mfg
+Summary         : Trimmed imx-bootlets-src for manufacturing tool requirements.
+Group           : Applications/File
+AutoReqProv     : no
+%Description mfg
+imx-bootlets-src package contents restricted to just the files
+that are needed for programming the target.
+
+
+
+# patch1 imx-bootlets-src-11.01.00-1315841439.patch: modify the boot arguments in order to boot from flash instead of memory card.
+# patch2 imx-bootlets-src-11.01.00-1332172356.patch: modify power prep to not use battery for boot but to keep battery values updated in the battmonitor register.
+# patch3 : modifies boot_stream preparation to write results in a diffrent directory based on the current selected kernel
+# patch4: modifies boot_stream to drive the GPMI nand flash by ref_gpmi and not ref_xtal
 %Description
 %{summary}
 
 %Prep
-%setup -n %{name}-%{version}-%{release}
+%setup -n %{name}-11.01.00
+%patch1 -p1
+%patch2 -p1
+%patch3 -p1
+%patch4 -p1
+%patch5 -p1
+%patch6 -p1
 
 %Build
 export CMDLINE1="$PKG_BOOT_STREAM_CMDLINE1"
@@ -25,8 +62,7 @@
 export CMDLINE4="$PKG_BOOT_STREAM_CMDLINE4"
 
 PLATFORMSHORTNAME=`echo $PLATFORM | sed "s,imx\([0-9]*\).*,MX\1,g"`
-if [ "x$PLATFORMSHORTNAME" = "xMX233" ]
-then
+if test "$PLATFORMSHORTNAME" = "MX233"; then
     make -j1 MEM_TYPE="${PKG_BOOT_STREAM_MEMTYPE_PRECONFIG}"
 else
     make -j1 MEM_TYPE="${PKG_BOOT_STREAM_MEMTYPE_PRECONFIG}" BOARD=iMX28_EVK
@@ -37,10 +73,27 @@
 mkdir -p $RPM_BUILD_ROOT/%{pfx}/boot
 make install DESTDIR=$RPM_BUILD_ROOT/%{pfx}/boot
 
+install -m 644 %{SOURCE1} $RPM_BUILD_ROOT/%{pfx}/boot
+
+
+cd %{_builddir}/%{name}-11.01.00
+( cd $RPM_BUILD_ROOT; find .%{pfx} \( \( -not -type d \) -o \( -type d -empty \) \) -print | sed 's/^\.//' ) > all_files.lst
+sed '
+    \,^%{pfx}/boot, d;
+' all_files.lst > rfs_files.lst
+
 %Clean
 rm -rf $RPM_BUILD_ROOT
 make clean
 
-%Files
+%Files -f all_files.lst
+%defattr(-,root,root)
+
+
+%Files rfs -f rfs_files.lst
+%defattr(-,root,root)
+
+%Files mfg
 %defattr(-,root,root)
-%{pfx}/*
+%{pfx}/boot/imx28_ivt_linux.sb
+%{pfx}/boot/updater_ivt.sb
