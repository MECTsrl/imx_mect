#!/bin/sh

test -z "$ACTION" -o "$ACTION" != "add" && exit 0
test -z "$DEVTYPE" -o "$DEVTYPE" != "usb_device" && exit 0
test -z "$PRODUCT" && exit 0

eval $(echo $PRODUCT | awk -F/ '{ print "ms_vendor=" $1; print "ms_product=" $2; }')
test -z "$ms_vendor" -o -z "$ms_product" && exit 1

ms_data="$(tar Oxjf /usr/share/usb_modeswitch/configPack.tar.bz2 ${ms_vendor}:${ms_product} 2>/dev/null)"
test -z "$ms_data" && exit 1

exec usb_modeswitch -v $ms_vendor -p $ms_product -f "$ms_data"
